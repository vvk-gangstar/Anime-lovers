<script>
  const imageQueries = [
    'https://cdn2.thecatapi.com/images/MTY3ODIyMQ.jpg',
    'https://cdn2.thecatapi.com/images/MTc5ODIyMQ.jpg',
    'https://cdn2.thecatapi.com/images/MTYxODIyMQ.jpg',
    'https://cdn2.thecatapi.com/images/2oo.gif',
    'https://cdn2.thecatapi.com/images/bpc.jpg',
    'https://cdn2.thecatapi.com/images/6qi.jpg',
    'https://cdn2.thecatapi.com/images/9ccXTANkb.jpg',
    'https://cdn2.thecatapi.com/images/c9a.jpg',
    'https://cdn2.thecatapi.com/images/8gk.jpg',
    'https://cdn2.thecatapi.com/images/du.jpg'
  ];

  let lastIndex = -1; // track last shown image index

  const btn = document.getElementById('saveBtn');
  const imageWrap = document.getElementById('imageWrap');
  const theImage = document.getElementById('theImage');
  const spinner = document.getElementById('spinner');
  const closeBtn = document.getElementById('closeBtn');

  function showRandom() {
    imageWrap.style.display = 'block';
    spinner.style.display = 'block';
    theImage.classList.remove('visible');

    let newIndex;
    do {
      newIndex = Math.floor(Math.random() * imageQueries.length);
    } while (newIndex === lastIndex); // ensure it's different from last time
    lastIndex = newIndex;

    const url = imageQueries[newIndex];

    theImage.onload = () => {
      spinner.style.display = 'none';
      theImage.classList.add('visible');
    };
    theImage.onerror = () => {
      spinner.style.display = 'none';
      theImage.src = 'data:image/svg+xml;utf8,' + encodeURIComponent(
        `<svg xmlns="http://www.w3.org/2000/svg" width="900" height="600">
          <rect width="100%" height="100%" fill="#ffdcec"/>
          <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#b33d73" font-family="Arial, sans-serif" font-size="24">
            Image unavailable â€” showing placeholder
          </text>
        </svg>`
      );
      theImage.classList.add('visible');
    };

    theImage.src = url;
  }

  btn.addEventListener('click', showRandom);

  closeBtn.addEventListener('click', () => {
    imageWrap.style.display = 'none';
    theImage.classList.remove('visible');
    theImage.src = '';
  });

  btn.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' || e.key === ' ') { 
      e.preventDefault(); 
      showRandom(); 
    }
  });
</script>
